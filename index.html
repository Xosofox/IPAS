<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>IPAS - Ingress Portal Attack Simulator</title>
    <script type="text/javascript" src="js/libs/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="js/libs/underscore-min.js"></script>
    <script type="text/javascript" src="js/libs/backbone-min.js"></script>
    <script type="text/javascript" src="js/libs/raphael-min.js"></script>
    <script type="text/javascript" src="js/libs/html5slider.js"></script>

    <script type="text/javascript" src="js/presets.js"></script>
    <script type="text/javascript" src="js/settings.js"></script>
    <script type="text/javascript" src="js/util.js"></script>

    <script type="text/javascript" src="js/models/Attack.js"></script>
    <script type="text/javascript" src="js/models/AttackCollection.js"></script>
    <script type="text/javascript" src="js/models/AttackSetup.js"></script>
    <script type="text/javascript" src="js/models/Portal.js"></script>
    <script type="text/javascript" src="js/models/Resonator.js"></script>
    <script type="text/javascript" src="js/models/ResonatorCollection.js"></script>

    <script type="text/javascript" src="js/views/AttackDamageView.js"></script>
    <script type="text/javascript" src="js/views/AttackInfoView.js"></script>
    <script type="text/javascript" src="js/views/AttackListView.js"></script>
    <script type="text/javascript" src="js/views/AttackSetupView.js"></script>
    <script type="text/javascript" src="js/views/PortalInfoView.js"></script>
    <script type="text/javascript" src="js/views/ResonatorDetailList.js"></script>
    <script type="text/javascript" src="js/views/ResonatorDetailView.js"></script>
    <script type="text/javascript" src="js/views/ResonatorView.js"></script>

    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Coda' rel='stylesheet' type='text/css' />
    <script type="text/javascript">
        /* <![CDATA[ */
        (function() {
            var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
            s.type = 'text/javascript';
            s.async = true;
            s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto';
            t.parentNode.insertBefore(s, t);
        })();
        /* ]]> */</script>
</head>

<body>

    <h1>IPAS - Ingress Portal Attack Simulator</h1>

    <p>Simulate an Attack! Select a configuration, drag & drop the resos, then click to attack.<br />
    Currently, distance influence is quadratic, not linear</p>
    Latest changes

    <ul>
        <li>0.9.0: Changed damage falloff to <a href="http://vi.reddit.com/r/Ingress/comments/17umoi/has_burster_falloff_ever_been_confirmed_to_be/">reddit</a> formula</li>
        <li>0.89: Show damage percentage on the reso</li>
        <li>0.88: Show damage details in the list</li>
    </ul>

    <div id="setup" style="float: left; width: 200px">
        Portal Info<br />

        <div id="portalinfo"></div>
        <br />
        Resonator Info<br />

        <div style="position: relative">
            <table width="100%">
                <tbody id="resonatorlist"></tbody>
            </table>
        </div>
    </div>
    <div id="paper" style="background-color: #333; width: 500px; height: 500px; float: left"></div>
    <div id="attackinfo" style="float: left">
        Attacks
        <div id="attacksetup"></div>
        <div id="attacklist"></div>
    </div>
    <div class="clearer"></div>
    <span>V 0.9.0 - Resistance FTW! Made by GraphRacer <a href="http://github.com/xosofox/IPAS">GitHub</a></span> <a
        href="http://profiles.google.com/xosofox">G+</a> <a href="http://twitter.com/xosofox">Twitter</a>
    <g:plusone href="http://ipas.graphracer.com" size="small"></g:plusone>
    <script type="text/javascript">
        (function () {
            var po = document.createElement('script');
            po.type = 'text/javascript';
            po.async = true;
            po.src = 'https://apis.google.com/js/plusone.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(po, s);
        })();
    </script>
    <a class="FlattrButton" style="display:none;" rev="flattr;button:compact;" href="http://ipas.graphracer.com/"></a>
    <noscript><a href="http://flattr.com/thing/1223254/IPAS-Ingress-Portal-Attack-Simulator" target="_blank">
        <img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a></noscript>
    <script type="text/javascript">


        var width = 500;
        var height = 500;
        var portalX = 250;
        var portalY = 250;
        var rimPix = 200;
        //rim in meters = 40m

        // Creates canvas
        var paper = Raphael(document.getElementById("paper"), width, height);
        var border = paper.rect(0, 0, width, height);
        border.attr("fill", "#f33");
        border.attr("opacity", 0.0);
        // Creates circle
        var portalDot = paper.circle(portalX, portalY, PORTAL_RADIUS);
        // Sets the fill attribute of the circle
        portalDot.attr("fill", "#3f3");
        // Sets the stroke attribute of the circle
        portalDot.attr("stroke", "#3c3");

        var rim = paper.circle(250, 250, 200);
        rim.attr("stroke", "#f3f");

        var crosshair = paper.circle(portalX, portalY, mInPx(42));
        border.mousemove(function (el, x, y) {
            var e = this.node;
            if (typeof e.offsetX === "undefined" || typeof e.offsetY === "undefined") {
                var targetOffset = $(e).offset();
                e.offsetX = targetOffset.left;
                e.offsetY = targetOffset.top;
            }
            x = x - e.offsetX;
            y = y - e.offsetY;
            crosshair.attr({"cx": x, "cy": y});
        });
        $("#paper").click(function (e) {
            if (typeof e.offsetX === "undefined" || typeof e.offsetY === "undefined") {
                var targetOffset = $(e.currentTarget).offset();
                e.offsetX = e.pageX - targetOffset.left;
                e.offsetY = e.pageY - targetOffset.top;
            }
            var x = e.offsetX;
            var y = e.offsetY;
            attacks.add({x: x, y: y, level: attackSetup.get("level")});
            e.preventDefault();
        });

        var portal = new Portal({ });
        var resonators = portal.get("resonators");
        var resonatorViews = [];
        var portalElements;
        var attacks = new AttackCollection();
        var attackSetup = new AttackSetup();
        var attackDamageView = new AttackDamageView({});
        $(document).ready(function () {
            /*
             resonators.add({"distanceToPortal": 34, energyTotal: 975, level: 4});
             resonators.add({"distanceToPortal": 24, energyTotal: 1975, level: 6});
             resonators.add({"distanceToPortal": 38, energyTotal: 1575, level: 5});
             resonators.add({"distanceToPortal": 35, energyTotal: 1575, level: 5});
             resonators.add({"distanceToPortal": 29, energyTotal: 657, level: 5});
             resonators.add({"distanceToPortal": 25, energyTotal: 832, level: 4});
             resonators.add({"distanceToPortal": 25, energyTotal: 645, level: 5});
             resonators.add({"distanceToPortal": 26, energyTotal: 2207, level: 7});
             */
            for (i = 0; i < 8; i++) {
                resonators.add({"distanceToPortal": 35, energyTotal: 1000, level: 1});
            }


            paper.setStart();
            resonators.each(function (reso, i) {
                var rv = new ResonatorView({
                    model: reso,
                    position: directions[i]
                });
                resonatorViews.push(rv);
                rv.render();
            })
            portalElements = paper.setFinish();

            var resolist = new ResonatorDetailList({
                el: "#resonatorlist",
                collection: resonators
            });

            var pinfo = new PortalInfoView({
                model: portal,
                el: '#portalinfo'
            });

            var ai = new AttackSetupView({
                model: attackSetup,
                el: "#attacksetup"
            });

            var alv = new AttackListView({
                collection: attacks,
                el: '#attacklist'
            });

        });
        border.toFront();

    </script>

    <!-- Piwik -->
    <script type="text/javascript">
        var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.graphracer.com/" : "http://stats.graphracer.com/");
        document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 15);
            piwikTracker.trackPageView();
            piwikTracker.enableLinkTracking();
        } catch (err) {
        }
    </script>
    <noscript><p><img src="http://stats.graphracer.com/piwik.php?idsite=15" style="border:0" alt="" /></p></noscript>
    <!-- End Piwik Tracking Code -->
</body>
</html>
